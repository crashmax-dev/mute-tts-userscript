var H=Object.defineProperty;var ee=(u,c,l)=>c in u?H(u,c,{enumerable:!0,configurable:!0,writable:!0,value:l}):u[c]=l;var h=(u,c,l)=>(ee(u,typeof c!="symbol"?c+"":c,l),l),D=(u,c,l)=>{if(!c.has(u))throw TypeError("Cannot "+l)};var E=(u,c,l)=>(D(u,c,"read from private field"),l?l.call(u):c.get(u)),P=(u,c,l)=>{if(c.has(u))throw TypeError("Cannot add the same private member more than once");c instanceof WeakSet?c.add(u):c.set(u,l)},x=(u,c,l,g)=>(D(u,c,"write to private field"),g?g.call(u,l):c.set(u,l),l);(function(){var b;"use strict";class u{constructor(){h(this,"queue");h(this,"isProcessing");this.queue=[],this.isProcessing=!1}add(e){this.queue.push(e),this.process()}async process(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length;){const e=this.queue.shift();e&&await e()}this.isProcessing=!1}}}function c(n,e){return new MutationObserver(i=>{for(const s of i){const o=Object.values(s.addedNodes),r=o.findIndex(f=>{const d=f.querySelector(".live-message-separator-line__hr");return Boolean(d)}),a=r!==-1?o.slice(0,r):o;console.log({addedNodes:a,lineIndex:r});for(const f of a){const d=f;if(d.classList.contains("muted"))return;if(d.classList.contains("chat-line__message")){const y=d.querySelector(".chat-author__display-name").textContent.toLowerCase(),{targetsUsernames:w}=n.data;(!w.length||w.includes(y))&&(d.classList.add("muted"),e(d,y))}}}})}function l(n,e){var t;console.log(`Toggle mute (${n}):`,e),(t=document.querySelector('[data-a-target="player-mute-unmute-button"]'))==null||t.click()}async function g(n){return new Promise(e=>setTimeout(e,n))}const I=3e3;function R(n){const e=new u;let t=!1;function i(o,r){if(n.data.commandsList.includes(o.toLowerCase().slice(1)))return;const a=async()=>{await g(I),l(r,!0),await g(n.data.muteMs),l(r,!1),e.process()};e.add(a)}const s=c(n,(o,r)=>{var f;const a=o.querySelector(".text-fragment");a&&((f=a.textContent)==null?void 0:f.charAt(0))==="!"&&(console.log({message:a.textContent,username:r}),i(a.textContent,r))});return{disconnect:()=>{s.disconnect()},observe:()=>{if(t)return;const o=document.querySelector(".chat-scrollable-area__message-container");o&&(t=!0,s.observe(o,{childList:!0}))}}}class V{constructor(e,t,i,s){h(this,"serialize");h(this,"deserialize");this.key=e,this.initialValue=t,this.storage=i,this.serialize=o=>s!=null&&s.serialize?s.serialize(o):JSON.stringify(o),this.deserialize=o=>s!=null&&s.deserialize?s.deserialize(o):JSON.parse(o)}get values(){try{const e=this.storage.getItem(this.key);return e?this.deserialize(e):this.initialValue}catch{return this.initialValue}}write(e){e instanceof Function&&(e=e(this.values));try{this.storage.setItem(this.key,this.serialize(e))}catch(t){return console.error(`Failed to save (${this.key}):`,t.message),this.initialValue}return e}reset(){this.write(this.initialValue)}}class F extends V{constructor(e,t,i){super(e,t,localStorage,i)}}function U(n,e){var t=B(n),i=t.tag,s=t.id,o=t.className,r=e?document.createElementNS(e,i):document.createElement(i);return s&&(r.id=s),o&&(e?r.setAttribute("class",o):r.className=o),r}function B(n){for(var e=n.split(/([.#])/),t="",i="",s=1;s<e.length;s+=2)switch(e[s]){case".":t+=" "+e[s+1];break;case"#":i=e[s+1]}return{className:t.trim(),tag:e[0]||"div",id:i}}function K(n,e){var t=_(n),i=_(e);return e===i&&i.__redom_view&&(e=i.__redom_view),i.parentNode&&(C(e,i,t),t.removeChild(i)),e}function C(n,e,t){var i=e.__redom_lifecycle;if(L(i)){e.__redom_lifecycle={};return}var s=t;for(e.__redom_mounted&&S(e,"onunmount");s;){var o=s.__redom_lifecycle||{};for(var r in i)o[r]&&(o[r]-=i[r]);L(o)&&(s.__redom_lifecycle=null),s=s.parentNode}}function L(n){if(n==null)return!0;for(var e in n)if(n[e])return!1;return!0}var J=["onmount","onremount","onunmount"],Q=typeof window<"u"&&"ShadowRoot"in window;function A(n,e,t,i){var s=_(n),o=_(e);e===o&&o.__redom_view&&(e=o.__redom_view),e!==o&&(o.__redom_view=e);var r=o.__redom_mounted,a=o.parentNode;if(r&&a!==s&&C(e,o,a),t!=null)if(i){var f=_(t);f.__redom_mounted&&S(f,"onunmount"),s.replaceChild(o,f)}else s.insertBefore(o,_(t));else s.appendChild(o);return Y(e,o,s,a),e}function S(n,e){e==="onmount"||e==="onremount"?n.__redom_mounted=!0:e==="onunmount"&&(n.__redom_mounted=!1);var t=n.__redom_lifecycle;if(t){var i=n.__redom_view,s=0;i&&i[e]&&i[e]();for(var o in t)o&&s++;if(s)for(var r=n.firstChild;r;){var a=r.nextSibling;S(r,e),r=a}}}function Y(n,e,t,i){for(var s=e.__redom_lifecycle||(e.__redom_lifecycle={}),o=t===i,r=!1,a=0,f=J;a<f.length;a+=1){var d=f[a];o||n!==e&&d in n&&(s[d]=(s[d]||0)+1),s[d]&&(r=!0)}if(!r){e.__redom_lifecycle={};return}var m=t,p=!1;for((o||m&&m.__redom_mounted)&&(S(e,o?"onremount":"onmount"),p=!0);m;){var y=m.parentNode,w=m.__redom_lifecycle||(m.__redom_lifecycle={});for(var M in s)w[M]=(w[M]||0)+s[M];if(p)break;(m.nodeType===Node.DOCUMENT_NODE||Q&&m instanceof ShadowRoot||y&&y.__redom_mounted)&&(S(m,o?"onremount":"onmount"),p=!0),m=y}}function $(n,e,t){var i=_(n);if(typeof e=="object")for(var s in e)O(i,s,e[s]);else O(i,e,t)}function O(n,e,t){n.style[e]=t??""}var j="http://www.w3.org/1999/xlink";function k(n,e,t,i){var s=_(n),o=typeof e=="object";if(o)for(var r in e)k(s,r,e[r],i);else{var a=s instanceof SVGElement,f=typeof t=="function";if(e==="style"&&typeof t=="object")$(s,t);else if(a&&f)s[e]=t;else if(e==="dataset")z(s,t);else if(!a&&(e in s||f)&&e!=="list")s[e]=t;else{if(a&&e==="xlink"){q(s,t);return}i&&e==="class"&&(t=s.className+" "+t),t==null?s.removeAttribute(e):s.setAttribute(e,t)}}}function q(n,e,t){if(typeof e=="object")for(var i in e)q(n,i,e[i]);else t!=null?n.setAttributeNS(j,e,t):n.removeAttributeNS(j,e,t)}function z(n,e,t){if(typeof e=="object")for(var i in e)z(n,i,e[i]);else t!=null?n.dataset[e]=t:delete n.dataset[e]}function X(n){return document.createTextNode(n??"")}function T(n,e,t){for(var i=0,s=e;i<s.length;i+=1){var o=s[i];if(!(o!==0&&!o)){var r=typeof o;r==="function"?o(n):r==="string"||r==="number"?n.appendChild(X(o)):W(_(o))?A(n,o):o.length?T(n,o,t):r==="object"&&k(n,o,null,t)}}}function _(n){return n.nodeType&&n||!n.el&&n||_(n.el)}function W(n){return n&&n.nodeType}function N(n){for(var e=[],t=arguments.length-1;t-- >0;)e[t]=arguments[t+1];var i,s=typeof n;if(s==="string")i=U(n);else if(s==="function"){var o=n;i=new(Function.prototype.bind.apply(o,[null].concat(e)))}else throw new Error("At least one argument required");return T(_(i),e,!0),i}var v=N;N.extend=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];return N.bind.apply(N,[this].concat(e))};const te="";class Z{constructor(e){h(this,"overlay");this.config=e,this.generateMenu(),document.addEventListener("keydown",t=>{t.code==="KeyQ"&&t.ctrlKey&&this.open()})}generateMenu(){const e=v("form",{className:"mt_form",onsubmit:a=>this.onSubmit(a,e)}),t=Object.entries(this.config.data);for(const[a,f]of t){const{description:d,type:m}=this.config.configMeta[a],p=v("input",{type:m,name:a,value:f,className:"mt_input"}),y=v("label",{for:a,className:"mt_label"},d),w=v("div",[y,p]);e.appendChild(w)}const i=v("button",{type:"submit",className:"mt_button mt_button_submit"},"Сохранить"),s=v("div",i);e.appendChild(s);const o=v("button",{className:"mt_modal_close",onclick:()=>this.close()},"✖"),r=v("div",{className:"mt_modal"},o,e);this.overlay=v("div",{className:"modal__backdrop"},r)}onSubmit(e,t){e.preventDefault();const i=new FormData(t),s={};for(const[o,r]of i.entries())switch(this.config.configMeta[o].type){case"text":s[o]=r.toString().toLowerCase().split(",");break;case"number":s[o]=Number(r);break}this.config.write(s),this.config.read()}open(){A(document.body,this.overlay)}close(){K(document.body,this.overlay)}}class G{constructor(){P(this,b,void 0);h(this,"config");h(this,"defaultOptions",{muteMs:5e3,targetsUsernames:["b0do4ka","vs_code"],commandsList:["ттс","tts"]});h(this,"configMeta",{commandsList:{description:"Список команд",type:"text"},muteMs:{description:"Время мута (ms)",type:"number"},targetsUsernames:{description:"Мутить пользователей",type:"text"}});this.config=new F("mute-tts-userscript",this.defaultOptions),this.read(),new Z(this)}get data(){return E(this,b)}read(){return x(this,b,this.config.values),this.data}write(e){this.config.write(t=>{const i=Object.assign(t,e);return x(this,b,i),t})}}b=new WeakMap,window.addEventListener("load",()=>{const n=new G,{observe:e}=R(n),{history:t}=window,{pushState:i,replaceState:s}=t;t.pushState=(...o)=>{i.apply(t,o),e()},t.replaceState=(...o)=>{s.apply(t,o),e()},e()}),console.warn("__STYLE__")})();
